/*! jodo-widget 2016-12-21 */
var Table={_renderData:function(a,b){var c=this,d="",e='<div class="btn-toolbar"><div class="btn-group pull-right focus-btn-group"><button class="btn btn-success">导出Excel</button><button class="btn btn-success showAllColumns">显示所有列</button></div></div>';if(b.data instanceof Object&&b.data.sort.length>0){var f=b.data.head;console.log(f);for(var g=0;g<f.length;g++)d+="<th>"+f[g]+'<span class="hideColumn" title="隐藏" data-column='+g+">×</span></th>";a.innerHTML=e+'<table id="'+b.id+'" class="display dt-bootstrap" cellspacing="0" width="100%"><thead><tr>'+d+"</tr></thead><tbody></tbody></table>",$("#"+b.id).tablesorter().bind("sortEnd",function(a){var d=b.cookieKey,e=a.target.config.sortList,f="orderColumn="+e[0][0]+"&orderDir="+e[0][1];c.setCookie(d,f,7),console.log(a.target.config.sortList)});for(var h=[],i=b.data.sort,g=0;g<i.length;g++)h.push({data:i[g]});var j={sProcessing:"处理中...",sLengthMenu:"每页 _MENU_ 项",sZeroRecords:"没有匹配结果",sInfo:"当前显示第 _START_ 至 _END_ 项，共 _TOTAL_ 项",sInfoEmpty:"当前显示第 0 至 0 项，共 0 项",sInfoFiltered:"(由 _MAX_ 项结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上一页",sNext:"下一页",sLast:"末页",sJump:"跳转"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},k=$("#"+b.id).DataTable({pageLength:b.data.page.pageSize+1,lengthChange:!1,searching:!1,language:j,ordering:!1,processing:!0,serverSide:!0,ajax:function(d,e,f){console.log(d);var g={};g.pageSize=b.pageSize,g.currentPage=d.start/d.length+1,$.ajax({type:b.ajaxType,url:a.getAttribute("data-url"),cache:!1,data:g,dataType:"json",contentType:"application/json",success:function(a){var f={};f.draw=d.draw,f.recordsTotal=a.data.page.recordCount,f.recordsFiltered=a.data.page.recordCount;var g=a.data.page.resList;g.push(a.data.total),f.data=g,e(f),$("#"+b.id).trigger("update"),setTimeout(function(){var a=[[1,1]],d=c.getCookie(b.cookieKey);d&&(a=[[parseInt(d.orderColumn[0]),parseInt(d.orderDir[0])]]),$("#"+b.id).trigger("sorton",[a])},1)}})},columns:h});$(".hideColumn").bind("click",function(a){a.stopPropagation(),k.column($(this).attr("data-column")).visible(!1)}),$(".showAllColumns").bind("click",function(){k.columns().visible(!0)})}else a.innerHTML='<div class="w_tableEmptyLoading">表格加载中，请稍后...</div>'},setCookie:function(a,b,c){$.cookie(a,b,{expires:c})},getCookie:function(a){var b=window.decodeURIComponent($.cookie(a)),c={};if("undefined"!==b){for(var d,e=b.split("&"),f=0;f<e.length;f++){var g=e[f].split("=")[0],h=e[f].split("=")[1],i=[];d!==g?(d=g,i.push(h),c[d]=i):(c[g]instanceof Array&&(i=c[g]),i.push(h),c[g]=i)}return c}return!1},init:function(){var a=this,b=Object.create(HTMLElement.prototype);b.createdCallback=function(){console.log("createdCallback");var b=this.getAttribute("data-id"),c=this.getAttribute("data-ajaxType"),d=this.getAttribute("data-url"),e=this.getAttribute("data-pageSize"),f=this.getAttribute("data-cookie");a._renderData(this,{id:b});var g=this;$.ajax({type:c,url:d,dataType:"json",contentType:"application/json",success:function(d){console.log("%csuccess","background: green; color: white;"),setTimeout(function(){a._renderData(g,{id:b,ajaxType:c,pageSize:e,cookieKey:f,data:d.data})},1e3)},error:function(){console.log("%cerror","background: red; color: white;")}})},b.attachedCallback=function(){console.log("attachedCallback")},document.registerElement("tag-table",{prototype:b})}};Table.init();